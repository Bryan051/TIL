## HA , DB 고가용성
- HA 구성을 한다는건 동일한 db를 복제한다는 소리.
- master(Writer)-slave(Read) db 구성 해서 synchronize 맞추면 1초 이내로 동기화가 될 것. 이렇게해서 각각 연결해주면 CQRS 가 될것이다.


## CQRS

- 회원, 동영상 - msa 로 하게된다면 레포지토리를 별도로 나눠야 한다.
  - 이후 동영상 msa 를 봤을 때 쓰기, 읽기가 혼재되어있고 쓰기가 오래걸리는 배치가 있는것.
  - 현재 구조는 하나의 서비스에서 배치를 떼서 soa 로 나눈것.
- 동영상과 관련된건 db를 하나만 쓴다. 배치의 row 데이터를 동영상 db를 이용해서 쌓는다.</br>
  동영상과 배치를 db 따로 가져오게되면 (결과를 카피해오는식으로) 의미가없다. 비효율적.

- 만약 msa를 해서 CQRS 를 한다면, 회원 서비스 db 2개, 동영상 서비스 db 2개.</br>
(2개는 각 읽기,쓰기) *현재 배치에서 리드 라이트 있는것처럼. 통계성 작업에는 쓰기보다 읽기가 훨씬많다 읽어와서 카운트한다.

- 동영상 서비스와 배치 서비스는 바라보는 db는 하나로 레플리케이션 구성이 되어있다.

- 지금은 애매해도 실서비스 생각해보면 리드가 훨씬 많다. 리드를 확장시키면 성능을 뽑아 낼 수 있다. 분산처리로 인해.
  - 보통 현업에서 CQRS 구성한다면 라이트 1개 리드 3개 식으로, 리드 옆에 레디스 둬서 트레픽 조정한다. 
  - DB커넥션 프로퍼티에 JDBC url 에 여러개 넣으면 알아서 돌려가면서 써준다.
  - RDS 오라클은 알아서 연결해준다 😂
  
 
